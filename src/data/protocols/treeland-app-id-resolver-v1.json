{
  "type": "protocol",
  "name": "treeland_app_id_resolver_v1",
  "copyright": {
    "type": "copyright",
    "text": "\nSPDX-FileCopyrightText: 2025 UnionTech Software Technology Co., Ltd.\nSPDX-License-Identifier: MIT\n"
  },
  "interfaces": [
    {
      "type": "interface",
      "name": "treeland_app_id_resolver_manager_v1",
      "version": "1",
      "description": {
        "type": "description",
        "text": "Create a resolver object. Typically exactly one privileged helper\n(a Wayland client with DBus access) binds this interface and serves\nidentification requests coming from the compositor.",
        "summary": "manager for app id resolver"
      },
      "requests": [
        {
          "type": "request",
          "name": "destroy",
          "requestType": "destructor",
          "description": {
            "type": "description",
            "summary": "destroy the manager"
          },
          "args": []
        },
        {
          "type": "request",
          "name": "get_resolver",
          "description": {
            "type": "description",
            "text": "Create or bind a resolver object. Only one resolver may be registered\nper session. Treeland is a multi-user compositor; different user\nsessions may each register their own resolver. If a resolver is\nalready bound in the same session, the compositor will report an\nerror on the manager and will NOT create a new resolver object for\nthis request.",
            "summary": "create/bind a resolver object"
          },
          "args": [
            {
              "type": "arg",
              "name": "id",
              "argType": "new_id",
              "interface": "treeland_app_id_resolver_v1"
            }
          ]
        }
      ],
      "events": [],
      "enums": [
        {
          "type": "enum",
          "name": "error",
          "bitfield": false,
          "entries": [
            {
              "type": "entry",
              "name": "resolver_already_exists",
              "value": "1",
              "summary": "A resolver is already registered in this session with the manager"
            }
          ]
        }
      ]
    },
    {
      "type": "interface",
      "name": "treeland_app_id_resolver_v1",
      "version": "1",
      "description": {
        "type": "description",
        "text": "The compositor sends identify_request with a unique request_id and a pidfd.\nThe client must answer exactly once via respond(request_id, app_id). If\nresolution fails respond with an empty string.",
        "summary": "app id resolver"
      },
      "requests": [
        {
          "type": "request",
          "name": "respond",
          "description": {
            "type": "description",
            "text": "Respond to an identify_request. The sandbox_engine_name must be provided and\nmatches the context in which the process is running (container, sandbox, etc).\nIf resolution fails, respond with an empty app_id.",
            "summary": "respond with app id and sandbox_engine_name (empty app_id on failure)"
          },
          "args": [
            {
              "type": "arg",
              "name": "request_id",
              "argType": "uint"
            },
            {
              "type": "arg",
              "name": "app_id",
              "argType": "string"
            },
            {
              "type": "arg",
              "name": "sandbox_engine_name",
              "argType": "string",
              "summary": "the sandbox engine / security context name (required, non-empty)"
            }
          ]
        },
        {
          "type": "request",
          "name": "destroy",
          "requestType": "destructor",
          "description": {
            "type": "description",
            "summary": "destroy resolver"
          },
          "args": []
        }
      ],
      "events": [
        {
          "type": "event",
          "name": "identify_request",
          "description": {
            "type": "description",
            "summary": "ask client to resolve pidfd to application id"
          },
          "args": [
            {
              "type": "arg",
              "name": "request_id",
              "argType": "uint",
              "summary": "monotonic id generated by compositor"
            },
            {
              "type": "arg",
              "name": "pidfd",
              "argType": "fd",
              "summary": "pidfd referencing the target process"
            }
          ]
        }
      ],
      "enums": []
    }
  ]
}
