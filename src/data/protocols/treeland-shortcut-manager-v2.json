{
  "type": "protocol",
  "name": "treeland_shortcut_manager_v2",
  "copyright": {
    "type": "copyright",
    "text": "\nSPDX-FileCopyrightText: 2024-2025 UnionTech Software Technology Co., Ltd.\nSPDX-License-Identifier: MIT\n"
  },
  "interfaces": [
    {
      "type": "interface",
      "name": "treeland_shortcut_manager_v2",
      "version": "1",
      "description": {
        "type": "description",
        "text": "This interface allows privileged clients to register global shortcuts.\n\nIn treeland, global shortcuts are managed in a per-user context.\nShortcuts for different users are isolated, and will not interfere with each other.\nThis allows multiple users to use their own set of global Shortcuts\non the same system without conflicts.\nThis behavior is transparent to the clients of this interface (i.e\nthe user context used by this protocol is the same as that of the client.)\n\nWarning! The protocol described in this file is currently in the testing\nphase. Backward compatible changes may be added together with the\ncorresponding interface version bump. Backward incompatible changes can\nonly be done by creating a new major version of the extension.",
        "summary": "global shortcuts manager for treeland"
      },
      "requests": [
        {
          "type": "request",
          "name": "destroy",
          "requestType": "destructor",
          "description": {
            "type": "description",
            "text": "Destroy the shortcut manager.\nExisting shortcuts created through this interface remain valid.",
            "summary": "destroy the shortcut manager"
          },
          "args": []
        },
        {
          "type": "request",
          "name": "acquire",
          "description": {
            "type": "description",
            "text": "Acquire the shortcut manager for the current client.\n\nThis request must be sent before any bind/unbind request can be performed.\n\nOnly one client hold exclusive control of the shortcut manager at a time,\nfor a given session.\nIf the shortcut manager is already acquired by another client, an protocol error",
            "summary": "acquire the shortcut manager"
          },
          "args": []
        },
        {
          "type": "request",
          "name": "bind_key",
          "description": {
            "type": "description",
            "text": "Bind a key sequence to a compositor action.\n\nThe key sequence is specified in the string format used by QKeySequence,\nsee https://doc.qt.io/qt-6/qkeysequence.html#toString for details.\n\nSending this request without first acquiring the shortcut manager\nwill result in a `not_acquired` protocol error.\n\nThe name argument must be unique among all existing bindings.\nIf a binding with the same name already exists, the bind_key request will fail.\n\nThe action argument specifies the compositor action to be executed\nwhen the key sequence is activated.\n\nThe protocol provides three keybinding modes:\n- key_release: the action is triggered when the key sequence is released.\n- key_press: the action is triggered when the key sequence is pressed.\n- key_press_repeat: the action is triggered when the key sequence is pressed,\nand repeatedly triggered if the key sequence is held down.\n\nIf a binding with the same key sequence and action already exists,\nthe bind_key request will fail.\n\nNote that the binding will not take effect until a commit request is sent.",
            "summary": "bind a key sequence to a compositor action"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "unique name for the keybinding"
            },
            {
              "type": "arg",
              "name": "key",
              "argType": "string",
              "summary": "key sequence for the keybinding"
            },
            {
              "type": "arg",
              "name": "mode",
              "argType": "uint",
              "summary": "mode for the keybinding",
              "enum": "keybind_mode"
            },
            {
              "type": "arg",
              "name": "action",
              "argType": "uint",
              "summary": "compositor action to be executed",
              "enum": "action"
            }
          ]
        },
        {
          "type": "request",
          "name": "bind_swipe_gesture",
          "description": {
            "type": "description",
            "text": "Bind a swipe gesture to a compositor action.\n\nSending this request without first acquiring the shortcut manager\nwill result in a `not_acquired` protocol error.\n\nThe name argument must be unique among all existing bindings.\nIf a binding with the same name already exists, the bind_swipe_gesture request will fail.\n\nThe direction argument specifies the direction towards which the swipe gesture must be performed.\nIf this argument is not one of the defined enum values, the bind_swipe_gesture request will fail.\n\nThe action argument specifies the compositor action to be executed\nwhen the swipe gesture is activated.\nIf a binding with the same gesture and action already exists,\nthe bind_swipe_gesture request will fail.\n\nNote that the binding will not take effect until a commit request is sent.",
            "summary": "bind a swipe gesture to a compositor action"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "unique name for the swipe gesture"
            },
            {
              "type": "arg",
              "name": "finger",
              "argType": "uint",
              "summary": "number of fingers required for the swipe gesture"
            },
            {
              "type": "arg",
              "name": "direction",
              "argType": "uint",
              "summary": "direction of the swipe gesture",
              "enum": "direction"
            },
            {
              "type": "arg",
              "name": "action",
              "argType": "uint",
              "summary": "compositor action to be executed",
              "enum": "action"
            }
          ]
        },
        {
          "type": "request",
          "name": "bind_hold_gesture",
          "description": {
            "type": "description",
            "text": "Bind a hold gesture to a compositor action.\n\nSending this request without first acquiring the shortcut manager\nwill result in a `not_acquired` protocol error.\n\nThe name argument must be unique among all existing bindings.\nIf a binding with the same name already exists, the bind_hold_gesture request will fail.\n\nThe action argument specifies the compositor action to be executed\nwhen the hold gesture is activated.\nIf a binding with the same gesture and action already exists,\nthe bind_hold_gesture request will fail.\n\nNote that the binding will not take effect until a commit request is sent.",
            "summary": "bind a hold gesture to a compositor action"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "unique name for the hold gesture"
            },
            {
              "type": "arg",
              "name": "finger",
              "argType": "uint",
              "summary": "number of fingers required for the hold gesture"
            },
            {
              "type": "arg",
              "name": "action",
              "argType": "uint",
              "summary": "compositor action to be executed",
              "enum": "action"
            }
          ]
        },
        {
          "type": "request",
          "name": "commit",
          "description": {
            "type": "description",
            "text": "Commit the pending bindings.\n\nThis request applies all the bind_key, bind_swipe_gesture and bind_hold_gesture\nrequests sent since the last commit.\n\nAfter processing this request, the compositor will emit a `commit_status` event\nif the commit was successful or `commit_failure` event if the commit failed.\n\nOn a successful commit, all the pending bindings will take effect.\nOn a failed commit, none of the pending bindings will take effect.\n\nSending this request without first acquiring the shortcut manager\nwill result in a `not_acquired` protocol error.\n\nSending further commit requests before `commit_success` or `commit_failure`\nis sent is a protocol error.",
            "summary": "commit the pending bindings"
          },
          "args": []
        },
        {
          "type": "request",
          "name": "unbind",
          "description": {
            "type": "description",
            "text": "Remove an existing binding.\n\nThe binding to be removed is identified by its unique name.\nIf no binding with the specified name exists, the unbind request has no effect.",
            "summary": "remove an existing binding"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "unique name of the binding to be removed"
            }
          ]
        }
      ],
      "events": [
        {
          "type": "event",
          "name": "activated",
          "description": {
            "type": "description",
            "text": "This event is emitted when a binding registered with action `notify` is activated.\n\nIf the binding is activated due to auto-repeat, the repeat argument will be non-zero.",
            "summary": "a shortcut has been activated"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "binding id of the activated shortcut"
            },
            {
              "type": "arg",
              "name": "repeat",
              "argType": "uint",
              "summary": "indicates whether the shortcut activation is due to auto-repeat"
            }
          ]
        },
        {
          "type": "event",
          "name": "commit_success",
          "description": {
            "type": "description",
            "text": "This event is emitted in response to a commit request,\nindicating that the commit was successful.",
            "summary": "the last commit was successful"
          },
          "args": []
        },
        {
          "type": "event",
          "name": "commit_failure",
          "description": {
            "type": "description",
            "text": "This event is emitted in response to a commit request,\nindicating that the commit has failed.\n\nThe error argument indicates the first error that caused the commit to fail.",
            "summary": "the last commit has failed"
          },
          "args": [
            {
              "type": "arg",
              "name": "name",
              "argType": "string",
              "summary": "binding name that caused the failure"
            },
            {
              "type": "arg",
              "name": "error",
              "argType": "uint",
              "summary": "error code indicating the reason of the failure",
              "enum": "bind_error"
            }
          ]
        }
      ],
      "enums": [
        {
          "type": "enum",
          "name": "direction",
          "bitfield": false,
          "entries": [
            {
              "type": "entry",
              "name": "down",
              "value": "1"
            },
            {
              "type": "entry",
              "name": "left",
              "value": "2"
            },
            {
              "type": "entry",
              "name": "up",
              "value": "3"
            },
            {
              "type": "entry",
              "name": "right",
              "value": "4"
            }
          ]
        },
        {
          "type": "enum",
          "name": "action",
          "bitfield": false,
          "description": {
            "type": "description",
            "text": "Compositor actions that can be assigned to a shortcut.",
            "summary": "compositor actions"
          },
          "entries": [
            {
              "type": "entry",
              "name": "notify",
              "value": "1"
            },
            {
              "type": "entry",
              "name": "workspace_1",
              "value": "2"
            },
            {
              "type": "entry",
              "name": "workspace_2",
              "value": "3"
            },
            {
              "type": "entry",
              "name": "workspace_3",
              "value": "4"
            },
            {
              "type": "entry",
              "name": "workspace_4",
              "value": "5"
            },
            {
              "type": "entry",
              "name": "workspace_5",
              "value": "6"
            },
            {
              "type": "entry",
              "name": "workspace_6",
              "value": "7"
            },
            {
              "type": "entry",
              "name": "prev_workspace",
              "value": "8"
            },
            {
              "type": "entry",
              "name": "next_workspace",
              "value": "9"
            },
            {
              "type": "entry",
              "name": "show_desktop",
              "value": "10"
            },
            {
              "type": "entry",
              "name": "maximize",
              "value": "11"
            },
            {
              "type": "entry",
              "name": "cancel_maximize",
              "value": "12"
            },
            {
              "type": "entry",
              "name": "move_window",
              "value": "13"
            },
            {
              "type": "entry",
              "name": "close_window",
              "value": "14"
            },
            {
              "type": "entry",
              "name": "show_window_menu",
              "value": "15"
            },
            {
              "type": "entry",
              "name": "open_multitask_view",
              "value": "16"
            },
            {
              "type": "entry",
              "name": "close_multitask_view",
              "value": "17"
            },
            {
              "type": "entry",
              "name": "toggle_multitask_view",
              "value": "18"
            },
            {
              "type": "entry",
              "name": "toggle_fps_display",
              "value": "19"
            },
            {
              "type": "entry",
              "name": "lockscreen",
              "value": "20"
            },
            {
              "type": "entry",
              "name": "shutdown_menu",
              "value": "21"
            },
            {
              "type": "entry",
              "name": "quit",
              "value": "22"
            },
            {
              "type": "entry",
              "name": "taskswitch_enter",
              "value": "23"
            },
            {
              "type": "entry",
              "name": "taskswitch_next",
              "value": "24"
            },
            {
              "type": "entry",
              "name": "taskswitch_prev",
              "value": "25"
            },
            {
              "type": "entry",
              "name": "taskswitch_sameapp_next",
              "value": "26"
            },
            {
              "type": "entry",
              "name": "taskswitch_sameapp_prev",
              "value": "27"
            }
          ]
        },
        {
          "type": "enum",
          "name": "keybind_mode",
          "bitfield": false,
          "description": {
            "type": "description",
            "text": "Keybinding modes.",
            "summary": "keybinding modes"
          },
          "entries": [
            {
              "type": "entry",
              "name": "key_release",
              "value": "1"
            },
            {
              "type": "entry",
              "name": "key_press",
              "value": "2"
            },
            {
              "type": "entry",
              "name": "key_press_repeat",
              "value": "3"
            }
          ]
        },
        {
          "type": "enum",
          "name": "bind_error",
          "bitfield": false,
          "description": {
            "type": "description",
            "text": "Error codes indicating the reason of a binding failure.",
            "summary": "binding error codes"
          },
          "entries": [
            {
              "type": "entry",
              "name": "name_conflict",
              "value": "1"
            },
            {
              "type": "entry",
              "name": "duplicate_binding",
              "value": "2"
            },
            {
              "type": "entry",
              "name": "invalid_argument",
              "value": "3"
            },
            {
              "type": "entry",
              "name": "internal_error",
              "value": "4"
            }
          ]
        },
        {
          "type": "enum",
          "name": "error",
          "bitfield": false,
          "entries": [
            {
              "type": "entry",
              "name": "occupied",
              "value": "1"
            },
            {
              "type": "entry",
              "name": "not_acquired",
              "value": "2"
            },
            {
              "type": "entry",
              "name": "invalid_commit",
              "value": "3"
            }
          ]
        }
      ]
    }
  ]
}
